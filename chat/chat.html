<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Fresca&family=Montserrat:ital,wght@0,400;0,500;1,400;1,500&display=swap" rel="stylesheet">
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
        <link rel="stylesheet" href="css/chat.css">
        <link rel="icon" href="assent/favicon.ico" type="image/x-icon">
        <title>Lobby</title>
    </head>
    <body>
        <header class="header">
            <img class="header-logo" src="assent/Untitled-fig (1).png" alt="Logo">
            <div class="header-config">
                <div class="header-config-user">
                    <img src="assent/avatar/avatar1.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                <div class="header-config-exit">
                    <ion-icon name="log-out-outline"></ion-icon>
                </div>
                <div class="header-config-menu" id="menu">
                    <span class="line" id="l1"></span>
                    <span class="line" id="l2"></span>
                    <span class="line" id="l3"></span>
                </div>
            </div>
        </header>
        <main class="main">
            <div class="main-usuarios" id="usuarios">
                <div class="main-usuarios-config">
                    <div class="main-usuarios-config-user">
                        <img src="assent/avatar/avatar1.png" alt="">
                        <p>Alisson</p>
                        <div class="curtida sem" id="coracao">
                            <ion-icon name="heart" class="curti"></ion-icon>
                            <p>0</p>
                        </div>
                    </div>
                    <div class="main-usuarios-config-exit" onclick="out()">
                        <ion-icon name="log-out-outline"></ion-icon>
                    </div>
                </div>

                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar2.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar1.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar2.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar4.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
                
                <div class="main-usuarios-user">
                    <img src="assent/avatar/avatar1.png" alt="">
                    <p>Alisson</p>
                    <div class="curtida sem">
                        <ion-icon name="heart-outline" class="nocurti"></ion-icon>
                        <ion-icon name="heart" class="curti"></ion-icon>
                        <p>0</p>
                    </div>
                </div>
            </div>
            <div class="main-conversa" id="conversa_cont">
                <div class="main-conversa-mensagens" id="conversa">
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Premium designed icons for use in web, iOS, Android, and desktop apps. Support for SVG and web font. sempletely open source, MIT licensed and built by Ionic.</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Premium designed icons for use in web, iOS, Android, and desktop apps. Support for SVG and web font. sempletely open source, MIT licensed and built by Ionic.</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Premium designed icons for use in web, iOS, Android, and desktop apps. Support for SVG and web font. sempletely open source, MIT licensed and built by Ionic.</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu img">
                        <p class="nome">Alisson</p>
                        <img class="img" src="assent/Leonardo_Diffusion_soft_Chinese_ink_painting_soft_colors_rice_0.jpg" alt="">
                        <p class="mensagem">Premium designed icons for use in web, iOS, Android, and desktop apps. Support for SVG and web font. sempletely open source, MIT licensed and built by Ionic</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Premium designed icons for use in web, iOS, Android, and desktop apps. Support for SVG and web font. sempletely open source, MIT licensed and built by Ionic.</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem meu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                    <div class="main-conversa-mensagens-mensagem seu text">
                        <p class="nome">Alisson</p>
                        <p class="mensagem">Olá, tudo bem</p>
                    </div>
                </div>
                <div class="main-conversa-input">
                    <input style="display: none;" type="file" name="img" id="img">
                    <label class="imagem" for="img"><ion-icon name="image-outline"></ion-icon></label>
                    <input class="mens" type="text" placeholder="Mensagem ...">
                    <button class="enviar"><ion-icon name="paper-plane-outline"></ion-icon></button>
                </div>
            </div>
        </main>
    </body>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var menu = document.getElementById("menu");
        var usuarios = document.getElementById("usuarios");

        menu.addEventListener("click", () => {
            if(usuarios.classList[1] == "active") {
                usuarios.classList.remove("active");
                menu.classList.remove("active")
            } else {
                usuarios.classList.add("active");
                menu.classList.add("active")
            }
        })


        var conversaContent = document.getElementById("conversa_cont");
        var alturaBarraNavegacao = window.innerHeight - document.documentElement.clientHeight;

        conversaContent.style.height = 'calc(100vh - ' + alturaBarraNavegacao + 'px - 80px)';
    </script>
    <script>
        var curtida = document.querySelectorAll('.curtida');

        for (var i = 0; i < curtida.length; i++) {
        curtida[i].addEventListener("click", function() {
            if (this.classList.contains("sem")) {
                this.classList.remove("sem");
                this.classList.add("com");
            } else {
                this.classList.remove("com");
                this.classList.add("sem");
            }
        });
        }
    </script>
    <script>
        var conversa = document.getElementById("conversa");

        window.addEventListener("load", function() {
            conversa.scrollTop = conversa.scrollHeight;
        });
        
    </script>
    <script>
        function mainUserDiv({nome, avatar}) {
            const usersList = document.querySelector('#usuarios')
            // Cria a div principal
            var divPrincipal = document.createElement("div");
            divPrincipal.classList.add("main-usuarios-config");

            // Cria a div do usuário
            var divUsuario = document.createElement("div");
            divUsuario.classList.add("main-usuarios-config-user");

            // Cria a tag de imagem do usuário
            var imgUsuario = document.createElement("img");
            imgUsuario.src = avatar
            imgUsuario.alt = "";

            // Cria o parágrafo com o nome do usuário
            var pUsuario = document.createElement("p");
            pUsuario.innerText = nome

            // Cria a div de curtida do usuário
            var divCurtidaUsuario = document.createElement("div");
            divCurtidaUsuario.classList.add("curtida", "sem");

            // Cria o ícone de coração curtido do usuário
            var iconCurtidoUsuario = document.createElement("ion-icon");
            iconCurtidoUsuario.name = "heart";
            iconCurtidoUsuario.classList.add("curti");

            // Cria o parágrafo com o número de curtidas do usuário
            var pCurtidasUsuario = document.createElement("p");
            pCurtidasUsuario.innerText = "0";

            // Adiciona os elementos filhos à div de curtida do usuário
            divCurtidaUsuario.appendChild(iconCurtidoUsuario);
            divCurtidaUsuario.appendChild(pCurtidasUsuario);

            // Adiciona os elementos filhos à div do usuário
            divUsuario.appendChild(imgUsuario);
            divUsuario.appendChild(pUsuario);
            divUsuario.appendChild(divCurtidaUsuario);

            // Cria a div de saída
            var divSaida = document.createElement("div");
            divSaida.classList.add("main-usuarios-config-exit");

            // Cria o ícone de saída
            var iconSaida = document.createElement("ion-icon");
            iconSaida.name = "log-out-outline";

            // Adiciona o ícone de saída à div de saída
            divSaida.appendChild(iconSaida);

            // Adiciona os elementos filhos à div principal
            divPrincipal.appendChild(divUsuario);
            divPrincipal.appendChild(divSaida);

            // Adiciona a div principal ao corpo do documento HTML
            usersList.appendChild(divPrincipal);
        }

        function userDiv({nome, avatar, id}) {
            const usersList = document.querySelector('#usuarios')
            // Cria a div principal
            var divPrincipal = document.createElement("div");
            divPrincipal.classList.add("main-usuarios-user");
            divPrincipal.id = id

            // Cria a tag de imagem
            var img = document.createElement("img");
            img.src = avatar
            img.alt = "";

            // Cria o parágrafo com o nome
            var p = document.createElement("p");
            p.innerText = nome

            // Cria a div de curtida
            var divCurtida = document.createElement("div");
            divCurtida.classList.add("curtida", "sem");

            // Cria o ícone de coração não curtido
            var iconNaoCurtido = document.createElement("ion-icon");
            iconNaoCurtido.name = "heart-outline";
            iconNaoCurtido.classList.add("nocurti");

            // Cria o ícone de coração curtido
            var iconCurtido = document.createElement("ion-icon");
            iconCurtido.name = "heart";
            iconCurtido.classList.add("curti");

            // Cria o parágrafo com o número de curtidas
            var pCurtidas = document.createElement("p");
            pCurtidas.innerText = "0";

            // Adiciona os elementos filhos à div de curtida
            divCurtida.appendChild(iconNaoCurtido);
            divCurtida.appendChild(iconCurtido);
            divCurtida.appendChild(pCurtidas);

            // Adiciona os elementos filhos à div principal
            divPrincipal.appendChild(img);
            divPrincipal.appendChild(p);
            divPrincipal.appendChild(divCurtida);

            // Adiciona a div principal ao corpo do documento HTML
            usersList.appendChild(divPrincipal);

        }

        const socket = io()
        
        

        socket.on('connect',() => {
            console.log(socket.id)
        })
        //id
        const regex = /[?&]id=([^&#]*)/i
        const url = window.location.href
        const match = regex.exec(url)
        const id = match && match[1]
        socket.emit('identificacao', id)

        socket.on('pessoas conectadas', (users) => {
            const usersList = document.querySelector('#usuarios')
            usersList.innerHTML = ''
            for (let i in users) 
                if (users[i].socketID == socket.id) {
                    mainUserDiv(users[i])
                    break
                }
            
            for (let i in users)
                if (users[i].socketID != socket.id) {
                    userDiv(users[i])
                }
        })
    </script>
</html>